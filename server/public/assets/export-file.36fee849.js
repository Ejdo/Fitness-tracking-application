import{b as me,u as ge,f as _e,c as te,a as he,Q as ae}from"./QBtn.d1f140d8.js";import{c as ne,j as be}from"./dom.543f5459.js";import{f as Fe,A as le}from"./QDialog.5f70cc3d.js";import{g as b,h as s,j as Y,y as w,M as ue,R as ie,c as ye,s as Se,t as ke,v as qe,aj as xe,L as ze,ag as we,ak as Ue,af as Ce}from"./index.10d3f647.js";import{u as Be,a as Re}from"./use-dark.f3ad74a0.js";const Le={...me,min:{type:Number,default:0},max:{type:Number,default:100},color:String,centerColor:String,trackColor:String,fontSize:String,rounded:Boolean,thickness:{type:Number,default:.2,validator:e=>e>=0&&e<=1},angle:{type:Number,default:0},showValue:Boolean,reverse:Boolean,instantFeedback:Boolean},X=50,se=2*X,de=se*Math.PI,je=Math.round(de*1e3)/1e3;var Ee=ne({name:"QCircularProgress",props:{...Le,value:{type:Number,default:0},animationSpeed:{type:[String,Number],default:600},indeterminate:Boolean},setup(e,{slots:i}){const{proxy:{$q:t}}=Y(),_=ge(e),n=b(()=>{const y=(t.lang.rtl===!0?-1:1)*e.angle;return{transform:e.reverse!==(t.lang.rtl===!0)?`scale3d(-1, 1, 1) rotate3d(0, 0, 1, ${-90-y}deg)`:`rotate3d(0, 0, 1, ${y-90}deg)`}}),m=b(()=>e.instantFeedback!==!0&&e.indeterminate!==!0?{transition:`stroke-dashoffset ${e.animationSpeed}ms ease 0s, stroke ${e.animationSpeed}ms ease`}:""),g=b(()=>se/(1-e.thickness/2)),R=b(()=>`${g.value/2} ${g.value/2} ${g.value} ${g.value}`),U=b(()=>Fe(e.value,e.min,e.max)),p=b(()=>de*(1-(U.value-e.min)/(e.max-e.min))),z=b(()=>e.thickness/2*g.value);function L({thickness:y,offset:a,color:o,cls:F,rounded:C}){return s("circle",{class:"q-circular-progress__"+F+(o!==void 0?` text-${o}`:""),style:m.value,fill:"transparent",stroke:"currentColor","stroke-width":y,"stroke-dasharray":je,"stroke-dashoffset":a,"stroke-linecap":C,cx:g.value,cy:g.value,r:X})}return()=>{const y=[];e.centerColor!==void 0&&e.centerColor!=="transparent"&&y.push(s("circle",{class:`q-circular-progress__center text-${e.centerColor}`,fill:"currentColor",r:X-z.value/2,cx:g.value,cy:g.value})),e.trackColor!==void 0&&e.trackColor!=="transparent"&&y.push(L({cls:"track",thickness:z.value,offset:0,color:e.trackColor})),y.push(L({cls:"circle",thickness:z.value,offset:p.value,color:e.color,rounded:e.rounded===!0?"round":void 0}));const a=[s("svg",{class:"q-circular-progress__svg",style:n.value,viewBox:R.value,"aria-hidden":"true"},y)];return e.showValue===!0&&a.push(s("div",{class:"q-circular-progress__text absolute-full row flex-center content-center",style:{fontSize:e.fontSize}},i.default!==void 0?i.default():[s("div",U.value)])),s("div",{class:`q-circular-progress q-circular-progress--${e.indeterminate===!0?"in":""}determinate`,style:_.value,role:"progressbar","aria-valuemin":e.min,"aria-valuemax":e.max,"aria-valuenow":e.indeterminate===!0?void 0:U.value},be(i.internal,a))}}});function M(e,i,t,_){const n=[];return e.forEach(m=>{_(m)===!0?n.push(m):i.push({failedPropValidation:t,file:m})}),n}function W(e){e&&e.dataTransfer&&(e.dataTransfer.dropEffect="copy"),ie(e)}const Pe={multiple:Boolean,accept:String,capture:String,maxFileSize:[Number,String],maxTotalSize:[Number,String],maxFiles:[Number,String],filter:Function},Ne=["rejected"];function Oe({editable:e,dnd:i,getFileInput:t,addFilesToQueue:_}){const{props:n,emit:m,proxy:g}=Y(),R=w(null),U=b(()=>n.accept!==void 0?n.accept.split(",").map(r=>(r=r.trim(),r==="*"?"*/":(r.endsWith("/*")&&(r=r.slice(0,r.length-1)),r.toUpperCase()))):null),p=b(()=>parseInt(n.maxFiles,10)),z=b(()=>parseInt(n.maxTotalSize,10));function L(r){if(e.value)if(r!==Object(r)&&(r={target:null}),r.target!==null&&r.target.matches('input[type="file"]')===!0)r.clientX===0&&r.clientY===0&&ue(r);else{const q=t();q&&q!==r.target&&q.click(r)}}function y(r){e.value&&r&&_(null,r)}function a(r,q,N,O){let u=Array.from(q||r.target.files);const S=[],B=()=>{S.length>0&&m("rejected",S)};if(n.accept!==void 0&&U.value.indexOf("*/")===-1&&(u=M(u,S,"accept",v=>U.value.some(h=>v.type.toUpperCase().startsWith(h)||v.name.toUpperCase().endsWith(h))),u.length===0))return B();if(n.maxFileSize!==void 0){const v=parseInt(n.maxFileSize,10);if(u=M(u,S,"max-file-size",h=>h.size<=v),u.length===0)return B()}if(n.multiple!==!0&&u.length>0&&(u=[u[0]]),u.forEach(v=>{v.__key=v.webkitRelativePath+v.lastModified+v.name+v.size}),O===!0){const v=N.map(h=>h.__key);u=M(u,S,"duplicate",h=>v.includes(h.__key)===!1)}if(u.length===0)return B();if(n.maxTotalSize!==void 0){let v=O===!0?N.reduce((h,T)=>h+T.size,0):0;if(u=M(u,S,"max-total-size",h=>(v+=h.size,v<=z.value)),u.length===0)return B()}if(typeof n.filter=="function"){const v=n.filter(u);u=M(u,S,"filter",h=>v.includes(h))}if(n.maxFiles!==void 0){let v=O===!0?N.length:0;if(u=M(u,S,"max-files",()=>(v++,v<=p.value)),u.length===0)return B()}if(B(),u.length>0)return u}function o(r){W(r),i.value!==!0&&(i.value=!0)}function F(r){ie(r),(r.relatedTarget!==null||ye.is.safari!==!0?r.relatedTarget!==R.value:document.elementsFromPoint(r.clientX,r.clientY).includes(R.value)===!1)===!0&&(i.value=!1)}function C(r){W(r);const q=r.dataTransfer.files;q.length>0&&_(null,q),i.value=!1}function f(r){if(i.value===!0)return s("div",{ref:R,class:`q-${r}__dnd absolute-full`,onDragenter:W,onDragover:W,onDragleave:F,onDrop:C})}return Object.assign(g,{pickFiles:L,addFiles:y}),{pickFiles:L,addFiles:y,onDragover:o,onDragleave:F,processFiles:a,getDndNode:f,maxFilesNumber:p,maxTotalSizeNumber:z}}function re(e){return(e*100).toFixed(2)+"%"}const Te={...Be,...Pe,label:String,color:String,textColor:String,square:Boolean,flat:Boolean,bordered:Boolean,noThumbnails:Boolean,autoUpload:Boolean,hideUploadBtn:Boolean,disable:Boolean,readonly:Boolean},ce=[...Ne,"start","finish","added","removed"];function Ae(e){const i=Y(),{props:t,slots:_,emit:n,proxy:m}=i,{$q:g}=m,R=Re(t,g);function U(l,c,k){if(l.__status=c,c==="idle"){l.__uploaded=0,l.__progress=0,l.__sizeLabel=le(l.size),l.__progressLabel="0.00%";return}if(c==="failed"){m.$forceUpdate();return}l.__uploaded=c==="uploaded"?l.size:k,l.__progress=c==="uploaded"?1:Math.min(.9999,l.__uploaded/l.size),l.__progressLabel=re(l.__progress),m.$forceUpdate()}const p=b(()=>t.disable!==!0&&t.readonly!==!0),z=w(!1),L=w(null),y=w(null),a={files:w([]),queuedFiles:w([]),uploadedFiles:w([]),uploadedSize:w(0),updateFileStatus:U,isAlive:()=>_e(i)===!1},{pickFiles:o,addFiles:F,onDragover:C,onDragleave:f,processFiles:r,getDndNode:q,maxFilesNumber:N,maxTotalSizeNumber:O}=Oe({editable:p,dnd:z,getFileInput:J,addFilesToQueue:V});Object.assign(a,e({props:t,slots:_,emit:n,helpers:a})),a.isBusy===void 0&&(a.isBusy=w(!1));const u=w(0),S=b(()=>u.value===0?0:a.uploadedSize.value/u.value),B=b(()=>re(S.value)),v=b(()=>le(u.value)),h=b(()=>p.value===!0&&a.isUploading.value!==!0&&(t.multiple===!0||a.queuedFiles.value.length===0)&&(t.maxFiles===void 0||a.files.value.length<N.value)&&(t.maxTotalSize===void 0||u.value<O.value)),T=b(()=>p.value===!0&&a.isBusy.value!==!0&&a.isUploading.value!==!0&&a.queuedFiles.value.length>0);Se(Ue,Z);const d=b(()=>"q-uploader column no-wrap"+(R.value===!0?" q-uploader--dark q-dark":"")+(t.bordered===!0?" q-uploader--bordered":"")+(t.square===!0?" q-uploader--square no-border-radius":"")+(t.flat===!0?" q-uploader--flat no-shadow":"")+(t.disable===!0?" disabled q-uploader--disable":"")+(z.value===!0?" q-uploader--dnd":"")),A=b(()=>"q-uploader__header"+(t.color!==void 0?` bg-${t.color}`:"")+(t.textColor!==void 0?` text-${t.textColor}`:""));ke(a.isUploading,(l,c)=>{c===!1&&l===!0?n("start"):c===!0&&l===!1&&n("finish")});function D(){t.disable===!1&&(a.abort(),a.uploadedSize.value=0,u.value=0,K(),a.files.value=[],a.queuedFiles.value=[],a.uploadedFiles.value=[])}function I(){t.disable===!1&&H(["uploaded"],()=>{a.uploadedFiles.value=[]})}function j(){H(["idle","failed"],({size:l})=>{u.value-=l,a.queuedFiles.value=[]})}function H(l,c){if(t.disable===!0)return;const k={files:[],size:0},E=a.files.value.filter(x=>l.indexOf(x.__status)===-1?!0:(k.size+=x.size,k.files.push(x),x.__img!==void 0&&window.URL.revokeObjectURL(x.__img.src),!1));k.files.length>0&&(a.files.value=E,c(k),n("removed",k.files))}function G(l){t.disable||(l.__status==="uploaded"?a.uploadedFiles.value=a.uploadedFiles.value.filter(c=>c.__key!==l.__key):l.__status==="uploading"?l.__abort():u.value-=l.size,a.files.value=a.files.value.filter(c=>c.__key!==l.__key?!0:(c.__img!==void 0&&window.URL.revokeObjectURL(c.__img.src),!1)),a.queuedFiles.value=a.queuedFiles.value.filter(c=>c.__key!==l.__key),n("removed",[l]))}function K(){a.files.value.forEach(l=>{l.__img!==void 0&&window.URL.revokeObjectURL(l.__img.src)})}function J(){return y.value||L.value.getElementsByClassName("q-uploader__input")[0]}function V(l,c){const k=r(l,c,a.files.value,!0),E=J();E!=null&&(E.value=""),k!==void 0&&(k.forEach(x=>{if(a.updateFileStatus(x,"idle"),u.value+=x.size,t.noThumbnails!==!0&&x.type.toUpperCase().startsWith("IMAGE")){const ee=new Image;ee.src=window.URL.createObjectURL(x),x.__img=ee}}),a.files.value=a.files.value.concat(k),a.queuedFiles.value=a.queuedFiles.value.concat(k),n("added",k),t.autoUpload===!0&&a.upload())}function ve(){T.value===!0&&a.upload()}function Q(l,c,k){if(l===!0){const E={type:"a",key:c,icon:g.iconSet.uploader[c],flat:!0,dense:!0};let x;return c==="add"?(E.onClick=o,x=Z):E.onClick=k,s(ae,E,x)}}function Z(){return s("input",{ref:y,class:"q-uploader__input overflow-hidden absolute-full",tabindex:-1,type:"file",title:"",accept:t.accept,multiple:t.multiple===!0?"multiple":void 0,capture:t.capture,onMousedown:ue,onClick:o,onChange:V})}function fe(){return _.header!==void 0?_.header($):[s("div",{class:"q-uploader__header-content column"},[s("div",{class:"flex flex-center no-wrap q-gutter-xs"},[Q(a.queuedFiles.value.length>0,"removeQueue",j),Q(a.uploadedFiles.value.length>0,"removeUploaded",I),a.isUploading.value===!0?s(te,{class:"q-uploader__spinner"}):null,s("div",{class:"col column justify-center"},[t.label!==void 0?s("div",{class:"q-uploader__title"},[t.label]):null,s("div",{class:"q-uploader__subtitle"},[v.value+" / "+B.value])]),Q(h.value,"add"),Q(t.hideUploadBtn===!1&&T.value===!0,"upload",a.upload),Q(a.isUploading.value,"clear",a.abort)])])]}function pe(){return _.list!==void 0?_.list($):a.files.value.map(l=>s("div",{key:l.__key,class:"q-uploader__file relative-position"+(t.noThumbnails!==!0&&l.__img!==void 0?" q-uploader__file--img":"")+(l.__status==="failed"?" q-uploader__file--failed":l.__status==="uploaded"?" q-uploader__file--uploaded":""),style:t.noThumbnails!==!0&&l.__img!==void 0?{backgroundImage:'url("'+l.__img.src+'")'}:null},[s("div",{class:"q-uploader__file-header row flex-center no-wrap"},[l.__status==="failed"?s(he,{class:"q-uploader__file-status",name:g.iconSet.type.negative,color:"negative"}):null,s("div",{class:"q-uploader__file-header-content col"},[s("div",{class:"q-uploader__title"},[l.name]),s("div",{class:"q-uploader__subtitle row items-center no-wrap"},[l.__sizeLabel+" / "+l.__progressLabel])]),l.__status==="uploading"?s(Ee,{value:l.__progress,min:0,max:1,indeterminate:l.__progress===0}):s(ae,{round:!0,dense:!0,flat:!0,icon:g.iconSet.uploader[l.__status==="uploaded"?"done":"clear"],onClick:()=>{G(l)}})])]))}qe(()=>{a.isUploading.value===!0&&a.abort(),a.files.value.length>0&&K()});const $={};for(const l in a)xe(a[l])===!0?ze($,l,()=>a[l].value):$[l]=a[l];return Object.assign($,{upload:ve,reset:D,removeUploadedFiles:I,removeQueuedFiles:j,removeFile:G,pickFiles:o,addFiles:F}),we($,{canAddFiles:()=>h.value,canUpload:()=>T.value,uploadSizeLabel:()=>v.value,uploadProgressLabel:()=>B.value}),Object.assign(m,$),()=>{const l=[s("div",{class:A.value},fe()),s("div",{class:"q-uploader__list scroll"},pe()),q("uploader")];a.isBusy.value===!0&&l.push(s("div",{class:"q-uploader__overlay absolute-full flex flex-center"},[s(te)]));const c={ref:L,class:d.value};return h.value===!0&&Object.assign(c,{onDragover:C,onDragleave:f}),s("div",c,l)}}const $e=()=>!0;function De(e){const i={};return e.forEach(t=>{i[t]=$e}),i}const Ie=De(ce);var Me=({name:e,props:i,emits:t,injectPlugin:_})=>ne({name:e,props:{...Te,...i},emits:Ce(t)===!0?{...Ie,...t}:[...ce,...t],setup(){return Ae(_)}});function P(e){return typeof e=="function"?e:()=>e}const Qe={url:[Function,String],method:{type:[Function,String],default:"POST"},fieldName:{type:[Function,String],default:()=>e=>e.name},headers:[Function,Array],formFields:[Function,Array],withCredentials:[Function,Boolean],sendRaw:[Function,Boolean],batch:[Function,Boolean],factory:Function},We=["factory-failed","uploaded","failed","uploading"];function He({props:e,emit:i,helpers:t}){const _=w([]),n=w([]),m=w(0),g=b(()=>({url:P(e.url),method:P(e.method),headers:P(e.headers),formFields:P(e.formFields),fieldName:P(e.fieldName),withCredentials:P(e.withCredentials),sendRaw:P(e.sendRaw),batch:P(e.batch)})),R=b(()=>m.value>0),U=b(()=>n.value.length>0);let p;function z(){_.value.forEach(o=>{o.abort()}),n.value.length>0&&(p=!0)}function L(){const o=t.queuedFiles.value.slice(0);t.queuedFiles.value=[],g.value.batch(o)?y(o):o.forEach(F=>{y([F])})}function y(o){if(m.value++,typeof e.factory!="function"){a(o,{});return}const F=e.factory(o);if(!F)i("factory-failed",new Error("QUploader: factory() does not return properly"),o),m.value--;else if(typeof F.catch=="function"&&typeof F.then=="function"){n.value.push(F);const C=f=>{t.isAlive()===!0&&(n.value=n.value.filter(r=>r!==F),n.value.length===0&&(p=!1),t.queuedFiles.value=t.queuedFiles.value.concat(o),o.forEach(r=>{t.updateFileStatus(r,"failed")}),i("factoryFailed",f,o),m.value--)};F.then(f=>{p===!0?C(new Error("Aborted")):t.isAlive()===!0&&(n.value=n.value.filter(r=>r!==F),a(o,f))}).catch(C)}else a(o,F||{})}function a(o,F){const C=new FormData,f=new XMLHttpRequest,r=(d,A)=>F[d]!==void 0?P(F[d])(A):g.value[d](A),q=r("url",o);if(!q){console.error("q-uploader: invalid or no URL specified"),m.value--;return}const N=r("formFields",o);N!==void 0&&N.forEach(d=>{C.append(d.name,d.value)});let O=0,u=0,S=0,B=0,v;f.upload.addEventListener("progress",d=>{if(v===!0)return;const A=Math.min(B,d.loaded);t.uploadedSize.value+=A-S,S=A;let D=S-u;for(let I=O;D>0&&I<o.length;I++){const j=o[I];if(D>j.size)D-=j.size,O++,u+=j.size,t.updateFileStatus(j,"uploading",j.size);else{t.updateFileStatus(j,"uploading",D);return}}},!1),f.onreadystatechange=()=>{f.readyState<4||(f.status&&f.status<400?(t.uploadedFiles.value=t.uploadedFiles.value.concat(o),o.forEach(d=>{t.updateFileStatus(d,"uploaded")}),i("uploaded",{files:o,xhr:f})):(v=!0,t.uploadedSize.value-=S,t.queuedFiles.value=t.queuedFiles.value.concat(o),o.forEach(d=>{t.updateFileStatus(d,"failed")}),i("failed",{files:o,xhr:f})),m.value--,_.value=_.value.filter(d=>d!==f))},f.open(r("method",o),q),r("withCredentials",o)===!0&&(f.withCredentials=!0);const h=r("headers",o);h!==void 0&&h.forEach(d=>{f.setRequestHeader(d.name,d.value)});const T=r("sendRaw",o);o.forEach(d=>{t.updateFileStatus(d,"uploading",0),T!==!0&&C.append(r("fieldName",d),d,d.name),d.xhr=f,d.__abort=()=>{f.abort()},B+=d.size}),i("uploading",{files:o,xhr:f}),_.value.push(f),T===!0?f.send(new Blob(o)):f.send(C)}return{isUploading:R,isBusy:U,abort:z,upload:L}}var Xe={name:"QUploader",props:Qe,emits:We,injectPlugin:He},Ze=Me(Xe);function oe(e){setTimeout(()=>{window.URL.revokeObjectURL(e.href)},1e4),e.remove()}function et(e,i,t={}){const{mimeType:_,byteOrderMark:n,encoding:m}=typeof t=="string"?{mimeType:t}:t,g=m!==void 0?new TextEncoder(m).encode([i]):i,R=n!==void 0?[n,g]:[g],U=new Blob(R,{type:_||"application/octet-stream"}),p=document.createElement("a");p.href=window.URL.createObjectURL(U),p.setAttribute("download",e),typeof p.download=="undefined"&&p.setAttribute("target","_blank"),p.classList.add("hidden"),p.style.position="fixed",document.body.appendChild(p);try{return p.click(),oe(p),!0}catch(z){return oe(p),z}}export{Ze as Q,et as e};
